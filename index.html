<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeon Crawler</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montaga&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #0a0a0f;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            display: block;
            touch-action: none;
            outline: none;
        }

        #ui {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            font-family: 'Montaga', 'Georgia', serif;
            z-index: 100;
        }

        /* Controls UI */
        #instructions {
            position: fixed;
            top: 20px;
            right: 20px;
            color: #b8a070;
            font-size: 12px;
            background: linear-gradient(180deg, rgba(20, 15, 10, 0.9) 0%, rgba(10, 8, 5, 0.95) 100%);
            padding: 15px 20px;
            border-radius: 4px;
            border: 1px solid #3d2f1f;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 200, 100, 0.05);
            line-height: 1.8;
            min-width: 180px;
        }

        #instructions .title {
            color: #ffd700;
            font-size: 14px;
            font-weight: bold;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        #instructions .key {
            display: inline-block;
            background: linear-gradient(180deg, #2a2015 0%, #1a1510 100%);
            color: #d4c4a0;
            padding: 2px 8px;
            border-radius: 3px;
            border: 1px solid #4a3a25;
            font-family: 'Consolas', monospace;
            font-size: 11px;
            margin-right: 8px;
            min-width: 45px;
            text-align: center;
            box-shadow: 0 2px 0 #0a0805;
        }

        #instructions .row {
            display: flex;
            align-items: center;
            margin: 6px 0;
        }

        #instructions .action {
            color: #998060;
            font-size: 11px;
        }

        /* Loading Screen */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #1a1510 0%, #0a0805 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            transition: opacity 0.5s ease-out;
        }

        #loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-content {
            text-align: center;
        }

        .loading-title {
            font-size: 3rem;
            color: #ffd700;
            letter-spacing: 0.3em;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5), 0 0 60px rgba(255, 140, 0, 0.3);
            margin-bottom: 3rem;
            animation: titlePulse 2s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { text-shadow: 0 0 30px rgba(255, 215, 0, 0.5), 0 0 60px rgba(255, 140, 0, 0.3); }
            50% { text-shadow: 0 0 40px rgba(255, 215, 0, 0.7), 0 0 80px rgba(255, 140, 0, 0.5); }
        }

        .loading-spinner {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 2rem;
        }

        .loading-spinner::before,
        .loading-spinner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid transparent;
        }

        .loading-spinner::before {
            border-top-color: #ffd700;
            border-right-color: #ffd700;
            animation: spinOuter 1.2s linear infinite;
        }

        .loading-spinner::after {
            width: 60%;
            height: 60%;
            top: 20%;
            left: 20%;
            border-bottom-color: #ff8c00;
            border-left-color: #ff8c00;
            animation: spinInner 0.8s linear infinite reverse;
        }

        @keyframes spinOuter {
            to { transform: rotate(360deg); }
        }

        @keyframes spinInner {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: #b8a070;
            font-size: 1rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }

        .loading-dots {
            display: inline-block;
            width: 20px;
            text-align: left;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0% { content: ''; }
            25% { content: '.'; }
            50% { content: '..'; }
            75% { content: '...'; }
            100% { content: ''; }
        }

        .loading-tip {
            margin-top: 3rem;
            padding: 1rem 2rem;
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 4px;
            color: #706040;
            font-size: 0.85rem;
            font-style: italic;
            max-width: 400px;
        }

        .loading-tip::before {
            content: '• ';
            color: #ffd700;
        }

        /* ========== WELCOME SCREEN ========== */
        #welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #1a1510 0%, #0a0805 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 350;
            font-family: 'Montaga', 'Georgia', serif;
        }

        #welcome-screen.hidden {
            display: none;
        }

        .welcome-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(ellipse at 30% 70%, rgba(255, 100, 0, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 30%, rgba(255, 200, 0, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(139, 105, 20, 0.1) 0%, transparent 60%);
            pointer-events: none;
        }

        .welcome-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(2px 2px at 15% 25%, rgba(255, 215, 0, 0.4), transparent),
                radial-gradient(2px 2px at 35% 65%, rgba(255, 180, 0, 0.25), transparent),
                radial-gradient(2px 2px at 55% 35%, rgba(255, 215, 0, 0.35), transparent),
                radial-gradient(2px 2px at 75% 75%, rgba(255, 180, 0, 0.25), transparent),
                radial-gradient(2px 2px at 85% 25%, rgba(255, 215, 0, 0.3), transparent),
                radial-gradient(3px 3px at 25% 85%, rgba(255, 140, 0, 0.2), transparent),
                radial-gradient(3px 3px at 65% 15%, rgba(255, 140, 0, 0.2), transparent);
            animation: welcomeParticles 25s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes welcomeParticles {
            0%, 100% { transform: translateY(0) scale(1); opacity: 0.6; }
            50% { transform: translateY(-30px) scale(1.1); opacity: 1; }
        }

        .welcome-content {
            position: relative;
            z-index: 1;
            text-align: center;
            max-width: 800px;
            padding: 2rem;
        }

        .welcome-title {
            font-size: 4.5rem;
            color: #ffd700;
            letter-spacing: 0.5em;
            text-shadow:
                0 0 50px rgba(255, 215, 0, 0.7),
                0 0 100px rgba(255, 140, 0, 0.5),
                0 0 150px rgba(255, 100, 0, 0.3),
                0 6px 0 #8b6914;
            margin-bottom: 0.5rem;
            animation: welcomeTitleGlow 4s ease-in-out infinite;
        }

        .welcome-subtitle {
            font-size: 1.4rem;
            color: #8b7355;
            letter-spacing: 0.4em;
            margin-bottom: 3rem;
            font-style: italic;
        }

        @keyframes welcomeTitleGlow {
            0%, 100% {
                text-shadow: 0 0 50px rgba(255, 215, 0, 0.7), 0 0 100px rgba(255, 140, 0, 0.5), 0 0 150px rgba(255, 100, 0, 0.3), 0 6px 0 #8b6914;
            }
            50% {
                text-shadow: 0 0 70px rgba(255, 215, 0, 0.9), 0 0 120px rgba(255, 140, 0, 0.7), 0 0 180px rgba(255, 100, 0, 0.5), 0 6px 0 #8b6914;
            }
        }

        .welcome-lore {
            background: rgba(0, 0, 0, 0.4);
            border-left: 4px solid #8b6914;
            border-right: 4px solid #8b6914;
            padding: 2rem 2.5rem;
            margin: 0 auto 3rem;
            max-width: 650px;
            border-radius: 4px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), inset 0 0 30px rgba(139, 105, 20, 0.1);
        }

        .welcome-lore p {
            color: #b8a070;
            font-size: 1.1rem;
            line-height: 1.9;
            margin-bottom: 1rem;
            font-style: italic;
        }

        .welcome-lore p:last-child {
            margin-bottom: 0;
            color: #d4c4a0;
        }

        .welcome-lore .lore-highlight {
            color: #ffd700;
            font-style: normal;
        }

        .welcome-btn {
            padding: 1.2rem 3.5rem;
            font-size: 1.4rem;
            font-family: 'Montaga', 'Georgia', serif;
            background: linear-gradient(180deg, #ffd700 0%, #cc9900 50%, #aa7700 100%);
            color: #1a1000;
            border: 3px solid #ffd700;
            border-radius: 6px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            transition: all 0.4s ease;
            box-shadow: 0 6px 30px rgba(255, 215, 0, 0.4), inset 0 2px 0 rgba(255, 255, 255, 0.3);
            animation: welcomeBtnPulse 2s ease-in-out infinite;
        }

        .welcome-btn:hover {
            background: linear-gradient(180deg, #ffe44d 0%, #ddaa00 50%, #bb8800 100%);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 40px rgba(255, 215, 0, 0.6), inset 0 2px 0 rgba(255, 255, 255, 0.3);
        }

        @keyframes welcomeBtnPulse {
            0%, 100% { box-shadow: 0 6px 30px rgba(255, 215, 0, 0.4), inset 0 2px 0 rgba(255, 255, 255, 0.3); }
            50% { box-shadow: 0 6px 40px rgba(255, 215, 0, 0.6), inset 0 2px 0 rgba(255, 255, 255, 0.3); }
        }

        .welcome-footer {
            position: absolute;
            bottom: 2rem;
            color: #4a3a25;
            font-size: 0.85rem;
            letter-spacing: 0.15em;
        }

        /* ========== MAIN MENU ========== */
        #main-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #1a1510 0%, #0a0805 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 300;
            font-family: 'Montaga', 'Georgia', serif;
        }

        #main-menu.hidden {
            display: none;
        }

        .menu-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(ellipse at 20% 80%, rgba(255, 100, 0, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(255, 200, 0, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        .menu-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(2px 2px at 10% 20%, rgba(255, 215, 0, 0.3), transparent),
                radial-gradient(2px 2px at 30% 70%, rgba(255, 180, 0, 0.2), transparent),
                radial-gradient(2px 2px at 50% 40%, rgba(255, 215, 0, 0.3), transparent),
                radial-gradient(2px 2px at 70% 80%, rgba(255, 180, 0, 0.2), transparent),
                radial-gradient(2px 2px at 90% 30%, rgba(255, 215, 0, 0.3), transparent);
            animation: floatParticles 20s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes floatParticles {
            0%, 100% { transform: translateY(0); opacity: 0.5; }
            50% { transform: translateY(-20px); opacity: 1; }
        }

        .menu-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .menu-title {
            font-size: 5rem;
            color: #ffd700;
            letter-spacing: 0.4em;
            text-shadow:
                0 0 40px rgba(255, 215, 0, 0.6),
                0 0 80px rgba(255, 140, 0, 0.4),
                0 4px 0 #8b6914;
            margin-bottom: 0.5rem;
            animation: menuTitleGlow 3s ease-in-out infinite;
        }

        .menu-subtitle {
            font-size: 1.2rem;
            color: #8b7355;
            letter-spacing: 0.3em;
            margin-bottom: 4rem;
            font-style: italic;
        }

        @keyframes menuTitleGlow {
            0%, 100% { text-shadow: 0 0 40px rgba(255, 215, 0, 0.6), 0 0 80px rgba(255, 140, 0, 0.4), 0 4px 0 #8b6914; }
            50% { text-shadow: 0 0 60px rgba(255, 215, 0, 0.8), 0 0 100px rgba(255, 140, 0, 0.6), 0 4px 0 #8b6914; }
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
        }

        .menu-btn {
            width: 280px;
            padding: 1rem 2rem;
            font-size: 1.2rem;
            font-family: 'Montaga', 'Georgia', serif;
            background: linear-gradient(180deg, rgba(40, 30, 20, 0.9) 0%, rgba(20, 15, 10, 0.95) 100%);
            color: #d4c4a0;
            border: 2px solid #4a3a25;
            border-radius: 4px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 200, 100, 0.1);
        }

        .menu-btn:hover {
            background: linear-gradient(180deg, rgba(60, 45, 30, 0.9) 0%, rgba(30, 22, 15, 0.95) 100%);
            border-color: #ffd700;
            color: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.2), inset 0 1px 0 rgba(255, 200, 100, 0.2);
        }

        .menu-btn.primary {
            background: linear-gradient(180deg, #ffd700 0%, #cc9900 50%, #aa7700 100%);
            color: #1a1000;
            border-color: #ffd700;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .menu-btn.primary:hover {
            background: linear-gradient(180deg, #ffe44d 0%, #ddaa00 50%, #bb8800 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(255, 215, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .menu-footer {
            position: absolute;
            bottom: 2rem;
            color: #4a3a25;
            font-size: 0.8rem;
            letter-spacing: 0.1em;
        }

        /* ========== SETTINGS PANEL ========== */
        #settings-panel, #rules-panel, #level-select-panel, #controls-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 600;
            font-family: 'Montaga', 'Georgia', serif;
        }

        #settings-panel.visible, #rules-panel.visible, #level-select-panel.visible, #controls-panel.visible {
            display: flex;
        }

        .panel-container {
            background: linear-gradient(180deg, rgba(30, 25, 20, 0.98) 0%, rgba(15, 12, 10, 0.99) 100%);
            border: 2px solid #4a3a25;
            border-radius: 8px;
            padding: 2.5rem 3rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8);
            scrollbar-width: thin;
            scrollbar-color: #6b5a3a #1a1510;
        }

        /* Custom scrollbar for Webkit browsers */
        .panel-container::-webkit-scrollbar {
            width: 8px;
        }

        .panel-container::-webkit-scrollbar-track {
            background: #1a1510;
            border-radius: 4px;
        }

        .panel-container::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #6b5a3a 0%, #4a3a25 100%);
            border-radius: 4px;
            border: 1px solid #3a2a15;
        }

        .panel-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #ffd700 0%, #b8960c 100%);
            border-color: #ffd700;
        }

        .panel-title {
            font-size: 2rem;
            color: #ffd700;
            text-align: center;
            letter-spacing: 0.2em;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .setting-group {
            margin-bottom: 1.5rem;
        }

        .setting-label {
            display: block;
            color: #b8a070;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
            letter-spacing: 0.1em;
        }

        .setting-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(90deg, #2a2015 0%, #1a1510 100%);
            border-radius: 4px;
            outline: none;
            border: 1px solid #4a3a25;
        }

        .setting-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(180deg, #ffd700 0%, #cc9900 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.4);
        }

        .setting-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(180deg, #ffd700 0%, #cc9900 100%);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.4);
        }

        .setting-value {
            color: #ffd700;
            font-size: 0.85rem;
            text-align: right;
            margin-top: 0.3rem;
        }

        .setting-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #2a2015;
            border-radius: 13px;
            cursor: pointer;
            border: 1px solid #4a3a25;
            transition: all 0.3s ease;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 18px;
            height: 18px;
            background: #706040;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: linear-gradient(90deg, #8b6914 0%, #ffd700 100%);
            border-color: #ffd700;
        }

        .toggle-switch.active::after {
            left: 27px;
            background: #fff;
        }

        .panel-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
        }

        .panel-btn {
            padding: 0.8rem 2rem;
            font-size: 1rem;
            font-family: 'Montaga', 'Georgia', serif;
            background: linear-gradient(180deg, rgba(40, 30, 20, 0.9) 0%, rgba(20, 15, 10, 0.95) 100%);
            color: #d4c4a0;
            border: 1px solid #4a3a25;
            border-radius: 4px;
            cursor: pointer;
            letter-spacing: 0.1em;
            transition: all 0.3s ease;
        }

        .panel-btn:hover {
            border-color: #ffd700;
            color: #ffd700;
        }

        .panel-btn.save {
            background: linear-gradient(180deg, #ffd700 0%, #cc9900 100%);
            color: #1a1000;
            border-color: #ffd700;
        }

        .panel-btn.save:hover {
            background: linear-gradient(180deg, #ffe44d 0%, #ddaa00 100%);
        }

        /* ========== RULES PANEL ========== */
        .rules-container {
            max-width: 600px;
        }

        .lore-section {
            background: rgba(255, 215, 0, 0.03);
            border-left: 3px solid #8b6914;
            padding: 1.5rem;
            margin-bottom: 2rem;
            font-style: italic;
            color: #a08050;
            line-height: 1.8;
        }

        .lore-section p {
            margin-bottom: 1rem;
        }

        .lore-section p:last-child {
            margin-bottom: 0;
        }

        .rules-section h3 {
            color: #ffd700;
            font-size: 1.1rem;
            margin: 1.5rem 0 1rem;
            letter-spacing: 0.1em;
        }

        .rules-section ul {
            list-style: none;
            padding: 0;
        }

        .rules-section li {
            color: #b8a070;
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            line-height: 1.6;
        }

        .rules-section li::before {
            content: '◆';
            position: absolute;
            left: 0;
            color: #8b6914;
            font-size: 0.7rem;
        }

        .enemy-list {
            display: grid;
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .enemy-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            border: 1px solid #2a2015;
        }

        .enemy-rank {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .enemy-rank.rank-1 { background: #8b0000; color: #ffcccc; }
        .enemy-rank.rank-2 { background: #4a0080; color: #e0ccff; }
        .enemy-rank.rank-3 { background: #006400; color: #ccffcc; }
        .enemy-rank.rank-4 { background: #2f4f4f; color: #cce0e0; }
        .enemy-rank.rank-5 { background: #8b4513; color: #ffe4cc; }

        .enemy-info {
            flex: 1;
        }

        .enemy-name {
            color: #d4c4a0;
            font-size: 0.95rem;
        }

        .enemy-desc {
            color: #706040;
            font-size: 0.8rem;
        }

        /* ========== LEVEL SELECT ========== */
        .level-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .level-card {
            background: linear-gradient(180deg, rgba(40, 30, 20, 0.8) 0%, rgba(20, 15, 10, 0.9) 100%);
            border: 2px solid #3a2a1a;
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .level-card:hover {
            border-color: #ffd700;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);
        }

        .level-number {
            font-size: 2rem;
            color: #ffd700;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        .level-name {
            color: #b8a070;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* ========== PAUSE MENU ========== */
        #pause-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 500;
            font-family: 'Montaga', 'Georgia', serif;
            backdrop-filter: blur(5px);
        }

        #pause-menu.visible {
            display: flex;
        }

        .pause-container {
            text-align: center;
        }

        .pause-title {
            font-size: 3rem;
            color: #ffd700;
            letter-spacing: 0.3em;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            margin-bottom: 3rem;
        }

        .pause-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
        }

        .pause-btn {
            width: 250px;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-family: 'Montaga', 'Georgia', serif;
            background: linear-gradient(180deg, rgba(40, 30, 20, 0.9) 0%, rgba(20, 15, 10, 0.95) 100%);
            color: #d4c4a0;
            border: 2px solid #4a3a25;
            border-radius: 4px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .pause-btn:hover {
            border-color: #ffd700;
            color: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.2);
        }

        .pause-btn.resume {
            background: linear-gradient(180deg, #ffd700 0%, #cc9900 50%, #aa7700 100%);
            color: #1a1000;
            border-color: #ffd700;
        }

        .pause-btn.resume:hover {
            background: linear-gradient(180deg, #ffe44d 0%, #ddaa00 50%, #bb8800 100%);
        }

        .pause-btn.quit {
            background: linear-gradient(180deg, rgba(80, 20, 20, 0.9) 0%, rgba(40, 10, 10, 0.95) 100%);
            border-color: #6a2a2a;
        }

        .pause-btn.quit:hover {
            border-color: #aa4444;
            color: #ff6666;
        }

        .pause-hint {
            margin-top: 2rem;
            color: #706040;
            font-size: 0.85rem;
            font-style: italic;
        }

        /* ========== FPS COUNTER ========== */
        #fps-counter {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #00ff00;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 4px;
            z-index: 100;
            display: none;
            border: 1px solid #004400;
        }

        #fps-counter.visible {
            display: block;
        }

        #fps-counter .fps-value {
            font-weight: bold;
        }

        #fps-counter.low {
            color: #ff4444;
            border-color: #440000;
        }

        #fps-counter.medium {
            color: #ffaa00;
            border-color: #443300;
        }

        /* ========== CONTROLS PANEL ========== */
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 0.8rem;
            align-items: center;
        }

        .control-label {
            color: #b8a070;
            font-size: 0.95rem;
        }

        .key-bind-btn {
            min-width: 80px;
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
            font-family: 'Consolas', monospace;
            background: linear-gradient(180deg, #2a2015 0%, #1a1510 100%);
            color: #ffd700;
            border: 1px solid #4a3a25;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }

        .key-bind-btn:hover {
            border-color: #ffd700;
            background: linear-gradient(180deg, #3a3025 0%, #2a2520 100%);
        }

        .key-bind-btn.listening {
            border-color: #ff6600;
            color: #ff6600;
            animation: pulse 0.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .controls-section-title {
            grid-column: 1 / -1;
            color: #ffd700;
            font-size: 1rem;
            margin-top: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        .controls-section-title:first-child {
            margin-top: 0;
        }

        .btn-controls {
            width: 100%;
            margin-top: 1rem;
            padding: 0.8rem;
            font-size: 0.95rem;
            background: linear-gradient(180deg, rgba(50, 40, 30, 0.9) 0%, rgba(30, 25, 20, 0.95) 100%);
        }

        /* ========== CHARACTER SELECT ========== */
        #character-select-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 600;
            font-family: 'Montaga', 'Georgia', serif;
        }

        #character-select-panel.visible {
            display: flex;
        }

        .character-select-container {
            max-width: 700px;
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .character-card {
            background: linear-gradient(180deg, rgba(40, 30, 20, 0.8) 0%, rgba(20, 15, 10, 0.9) 100%);
            border: 2px solid #3a2a1a;
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .character-card:hover {
            border-color: #ffd700;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }

        .character-card.selected {
            border-color: #ffd700;
            background: linear-gradient(180deg, rgba(60, 50, 30, 0.9) 0%, rgba(40, 30, 20, 0.95) 100%);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }

        .character-preview-container {
            width: 100%;
            height: 200px;
            position: relative;
            margin-bottom: 1rem;
            border-radius: 8px;
            overflow: hidden;
            background: radial-gradient(ellipse at center, rgba(30, 25, 20, 0.8) 0%, rgba(10, 8, 5, 0.95) 100%);
        }

        .character-preview-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .character-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #706040;
            font-size: 0.85rem;
            font-style: italic;
        }

        .character-preview-container.loaded .character-loading {
            display: none;
        }

        .character-name {
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .character-desc {
            color: #8b7355;
            font-size: 0.85rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            min-height: 50px;
        }

        .character-stats {
            margin-top: 1rem;
        }

        .character-stats .stat {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .character-stats .stat-label {
            color: #b8a070;
            font-size: 0.75rem;
            width: 60px;
            text-align: left;
        }

        .character-stats .stat-bar {
            flex: 1;
            height: 6px;
            background: #1a1510;
            border-radius: 3px;
            overflow: hidden;
        }

        .character-stats .stat-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b6914, #ffd700);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* ========== CROSSHAIR ========== */
        #crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 50;
            opacity: 0;
            transition: opacity 0.15s ease;
        }

        #crosshair.visible {
            opacity: 1;
        }

        #crosshair .crosshair-dot {
            width: 4px;
            height: 4px;
            background: #fff;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 2px rgba(0, 0, 0, 0.8);
        }

        #crosshair .crosshair-ring {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
        }

        #crosshair.aiming .crosshair-ring {
            width: 16px;
            height: 16px;
            border-color: #ffd700;
            transition: all 0.2s ease;
        }

        #crosshair .crosshair-line {
            position: absolute;
            background: rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
        }

        #crosshair .crosshair-line.top {
            width: 2px;
            height: 8px;
            top: -16px;
            left: 50%;
            transform: translateX(-50%);
        }

        #crosshair .crosshair-line.bottom {
            width: 2px;
            height: 8px;
            bottom: -16px;
            left: 50%;
            transform: translateX(-50%);
        }

        #crosshair .crosshair-line.left {
            width: 8px;
            height: 2px;
            left: -16px;
            top: 50%;
            transform: translateY(-50%);
        }

        #crosshair .crosshair-line.right {
            width: 8px;
            height: 2px;
            right: -16px;
            top: 50%;
            transform: translateY(-50%);
        }
    </style>
</head>
<body>
    <canvas id="renderCanvas"></canvas>

    <!-- Crosshair for Archer -->
    <div id="crosshair">
        <div class="crosshair-dot"></div>
        <div class="crosshair-ring"></div>
        <div class="crosshair-line top"></div>
        <div class="crosshair-line bottom"></div>
        <div class="crosshair-line left"></div>
        <div class="crosshair-line right"></div>
    </div>

    <!-- FPS Counter -->
    <div id="fps-counter">FPS: <span class="fps-value">60</span></div>

    <!-- Pause Menu -->
    <div id="pause-menu">
        <div class="pause-container">
            <h1 class="pause-title">PAUSE</h1>
            <div class="pause-buttons">
                <button class="pause-btn resume" id="pause-resume">Reprendre</button>
                <button class="pause-btn" id="pause-settings">Paramètres</button>
                <button class="pause-btn quit" id="pause-quit">Menu Principal</button>
            </div>
            <p class="pause-hint">Appuyez sur P pour reprendre</p>
        </div>
    </div>

    <!-- Welcome Screen -->
    <div id="welcome-screen">
        <div class="welcome-background"></div>
        <div class="welcome-particles"></div>
        <div class="welcome-content">
            <h1 class="welcome-title">DUNGEON</h1>
            <p class="welcome-subtitle">Les Cryptes de l'Oubli</p>
            <div class="welcome-lore">
                <p>Dans les profondeurs oubliées du royaume, les <span class="lore-highlight">Cryptes de l'Oubli</span> attendent depuis des siècles leur prochain visiteur. Des murmures anciens racontent que nul n'en est jamais revenu...</p>
                <p>Pourtant, les ténèbres qui s'y terrent menacent désormais de s'étendre au monde des vivants. <span class="lore-highlight">Un héros doit descendre</span> dans l'abîme pour affronter les horreurs qui y demeurent.</p>
                <p>Serez-vous celui qui brisera la malédiction ?</p>
            </div>
            <button class="welcome-btn" id="btn-enter">Entrer dans le Donjon</button>
        </div>
        <div class="welcome-footer">Games On Web 2026</div>
    </div>

    <!-- Main Menu -->
    <div id="main-menu" class="hidden">
        <div class="menu-background"></div>
        <div class="menu-particles"></div>
        <div class="menu-content">
            <h1 class="menu-title">DUNGEON</h1>
            <p class="menu-subtitle">Les Cryptes de l'Oubli</p>
            <div class="menu-buttons">
                <button class="menu-btn primary" id="btn-play">Jouer</button>
                <button class="menu-btn" id="btn-levels">Sélection Niveau</button>
                <button class="menu-btn" id="btn-random">Niveau Aléatoire</button>
                <button class="menu-btn" id="btn-rules">Règles & Histoire</button>
                <button class="menu-btn" id="btn-settings">Paramètres</button>
            </div>
        </div>
        <div class="menu-footer">Games On Web 2026</div>
    </div>

    <!-- Settings Panel -->
    <div id="settings-panel">
        <div class="panel-container">
            <h2 class="panel-title">Paramètres</h2>

            <div class="setting-group">
                <label class="setting-label">Volume Musique</label>
                <input type="range" class="setting-slider" id="music-volume" min="0" max="100" value="70">
                <div class="setting-value"><span id="music-value">70</span>%</div>
            </div>

            <div class="setting-group">
                <label class="setting-label">Volume Effets</label>
                <input type="range" class="setting-slider" id="sfx-volume" min="0" max="100" value="80">
                <div class="setting-value"><span id="sfx-value">80</span>%</div>
            </div>

            <div class="setting-group">
                <label class="setting-label">Sensibilité Souris</label>
                <input type="range" class="setting-slider" id="mouse-sensitivity" min="1" max="10" value="5">
                <div class="setting-value"><span id="sensitivity-value">5</span></div>
            </div>

            <div class="setting-group setting-toggle">
                <label class="setting-label">Afficher les FPS</label>
                <div class="toggle-switch" id="toggle-fps"></div>
            </div>

            <div class="setting-group setting-toggle">
                <label class="setting-label">Afficher les contrôles</label>
                <div class="toggle-switch active" id="toggle-controls"></div>
            </div>

            <div class="setting-group setting-toggle">
                <label class="setting-label">Mode accroupi (Toggle = cliquer, Hold = maintenir)</label>
                <div class="toggle-switch" id="toggle-crouch-mode"></div>
            </div>

            <button class="panel-btn btn-controls" id="btn-controls">Changer les Contrôles</button>

            <div class="panel-buttons">
                <button class="panel-btn" id="settings-cancel">Annuler</button>
                <button class="panel-btn save" id="settings-save">Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Controls Panel -->
    <div id="controls-panel">
        <div class="panel-container">
            <h2 class="panel-title">Contrôles</h2>

            <div class="controls-grid">
                <div class="controls-section-title">Déplacement</div>

                <span class="control-label">Avancer</span>
                <button class="key-bind-btn" data-action="forward">W</button>

                <span class="control-label">Reculer</span>
                <button class="key-bind-btn" data-action="backward">S</button>

                <span class="control-label">Gauche</span>
                <button class="key-bind-btn" data-action="left">A</button>

                <span class="control-label">Droite</span>
                <button class="key-bind-btn" data-action="right">D</button>

                <span class="control-label">Courir</span>
                <button class="key-bind-btn" data-action="run">Shift</button>

                <span class="control-label">Sauter</span>
                <button class="key-bind-btn" data-action="jump">Espace</button>

                <span class="control-label">S'accroupir</span>
                <button class="key-bind-btn" data-action="crouch">Ctrl</button>

                <div class="controls-section-title">Actions</div>

                <span class="control-label">Interagir</span>
                <button class="key-bind-btn" data-action="interact">F</button>

                <div class="controls-section-title">Système</div>

                <span class="control-label">Pause</span>
                <button class="key-bind-btn" data-action="pause">P</button>
            </div>

            <p style="color: #706040; font-size: 0.8rem; margin-top: 1.5rem; text-align: center; font-style: italic;">
                Cliquez sur une touche puis appuyez sur la nouvelle touche souhaitée.<br>
                Appuyez sur Échap pour annuler.
            </p>

            <div class="panel-buttons">
                <button class="panel-btn" id="controls-reset">Réinitialiser</button>
                <button class="panel-btn save" id="controls-back">Retour</button>
            </div>
        </div>
    </div>

    <!-- Rules Panel -->
    <div id="rules-panel">
        <div class="panel-container rules-container">
            <h2 class="panel-title">Les Cryptes de l'Oubli</h2>

            <div class="lore-section">
                <p>Il y a des siècles, le Roi Maudit Aldric scella son âme dans les profondeurs des Cryptes de l'Oubli, emportant avec lui des légions de créatures corrompues par sa magie noire.</p>
                <p>Nul n'en est jamais revenu vivant... jusqu'à aujourd'hui.</p>
                <p>Vous êtes le dernier Paladin de l'Ordre de l'Aube Dorée. Armé de votre épée bénie et de votre bouclier ancestral, vous devez purifier ces terres maudites et mettre fin au règne des ténèbres.</p>
            </div>

            <div class="rules-section">
                <h3>Contrôles</h3>
                <ul id="rules-controls-list">
                    <li><strong data-control="movement">ZQSD</strong> — Se déplacer</li>
                    <li><strong data-control="run">Shift</strong> — Courir</li>
                    <li><strong>Souris</strong> — Regarder autour</li>
                    <li><strong>Clic Gauche</strong> — Attaquer à l'épée</li>
                    <li><strong>Clic Droit</strong> — Lever le bouclier (bloque les attaques)</li>
                    <li><strong data-control="jump">Espace</strong> — Sauter</li>
                    <li><strong data-control="crouch">Ctrl</strong> — S'accroupir (réduit la détection ennemie)</li>
                    <li><strong data-control="interact">F</strong> — Interagir (ouvrir les coffres)</li>
                    <li><strong>1-4</strong> — Utiliser une potion</li>
                    <li><strong data-control="pause">P</strong> — Mettre le jeu en pause</li>
                </ul>

                <h3>Objectif</h3>
                <ul>
                    <li>Éliminez toutes les créatures de chaque niveau pour progresser</li>
                    <li>Ouvrez les coffres (tombes) pour trouver des potions de soin</li>
                    <li>Utilisez votre bouclier pour réduire les dégâts (70% chevalier, 50% archer)</li>
                    <li><strong>Archer:</strong> 5 flèches max — trouvez-en dans les coffres !</li>
                </ul>

                <h3>Créatures des Ténèbres</h3>
                <div class="enemy-list">
                    <div class="enemy-item">
                        <div class="enemy-rank rank-1">I</div>
                        <div class="enemy-info">
                            <div class="enemy-name">Vampire</div>
                            <div class="enemy-desc">Faible mais rapide, attaque en meute</div>
                        </div>
                    </div>
                    <div class="enemy-item">
                        <div class="enemy-rank rank-2">II</div>
                        <div class="enemy-info">
                            <div class="enemy-name">Parasite</div>
                            <div class="enemy-desc">Agile et vicieux, difficile à toucher</div>
                        </div>
                    </div>
                    <div class="enemy-item">
                        <div class="enemy-rank rank-3">III</div>
                        <div class="enemy-info">
                            <div class="enemy-name">Mutant</div>
                            <div class="enemy-desc">Équilibré, un adversaire redoutable</div>
                        </div>
                    </div>
                    <div class="enemy-item">
                        <div class="enemy-rank rank-4">IV</div>
                        <div class="enemy-info">
                            <div class="enemy-name">Zombie Squelette</div>
                            <div class="enemy-desc">Lent mais très résistant</div>
                        </div>
                    </div>
                    <div class="enemy-item">
                        <div class="enemy-rank rank-5">V</div>
                        <div class="enemy-info">
                            <div class="enemy-name">Warrok</div>
                            <div class="enemy-desc">Le gardien — puissance dévastatrice</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel-buttons">
                <button class="panel-btn save" id="rules-close">Compris</button>
            </div>
        </div>
    </div>

    <!-- Level Select Panel -->
    <div id="level-select-panel">
        <div class="panel-container">
            <h2 class="panel-title">Sélection du Niveau</h2>

            <div class="level-grid">
                <div class="level-card" data-level="1">
                    <div class="level-number">I</div>
                    <div class="level-name">Le Hall du Donjon</div>
                </div>
                <div class="level-card" data-level="2">
                    <div class="level-number">II</div>
                    <div class="level-name">Les Profondeurs</div>
                </div>
            </div>

            <div class="panel-buttons">
                <button class="panel-btn" id="levels-back">Retour</button>
            </div>
        </div>
    </div>

    <!-- Character Select Panel -->
    <div id="character-select-panel">
        <div class="panel-container character-select-container">
            <h2 class="panel-title">Choisissez votre Classe</h2>

            <div class="character-grid">
                <div class="character-card" data-class="knight">
                    <div class="character-preview-container">
                        <canvas id="knight-preview-canvas" class="character-preview-canvas"></canvas>
                        <div class="character-loading">Chargement...</div>
                    </div>
                    <div class="character-name">Chevalier</div>
                    <div class="character-desc">Guerrier robuste avec epee et bouclier. Excellent en defense et au corps a corps.</div>
                    <div class="character-stats">
                        <div class="stat"><span class="stat-label">Attaque</span><div class="stat-bar"><div class="stat-fill" style="width: 70%"></div></div></div>
                        <div class="stat"><span class="stat-label">Defense</span><div class="stat-bar"><div class="stat-fill" style="width: 90%"></div></div></div>
                        <div class="stat"><span class="stat-label">Portee</span><div class="stat-bar"><div class="stat-fill" style="width: 30%"></div></div></div>
                    </div>
                </div>

                <div class="character-card" data-class="archer">
                    <div class="character-preview-container">
                        <canvas id="archer-preview-canvas" class="character-preview-canvas"></canvas>
                        <div class="character-loading">Chargement...</div>
                    </div>
                    <div class="character-name">Archere</div>
                    <div class="character-desc">Combattante agile equipee d'un arc. Precise et mortelle a distance.</div>
                    <div class="character-stats">
                        <div class="stat"><span class="stat-label">Attaque</span><div class="stat-bar"><div class="stat-fill" style="width: 85%"></div></div></div>
                        <div class="stat"><span class="stat-label">Defense</span><div class="stat-bar"><div class="stat-fill" style="width: 40%"></div></div></div>
                        <div class="stat"><span class="stat-label">Portee</span><div class="stat-bar"><div class="stat-fill" style="width: 95%"></div></div></div>
                    </div>
                </div>
            </div>

            <div class="panel-buttons">
                <button class="panel-btn" id="character-back">Retour</button>
            </div>
        </div>
    </div>

    <div id="ui">
        <div id="instructions">
            <div class="title">Contrôles</div>
            <div class="row">
                <span class="key" data-control="movement">ZQSD</span>
                <span class="action">Se déplacer</span>
            </div>
            <div class="row">
                <span class="key" data-control="run">Shift</span>
                <span class="action">Courir</span>
            </div>
            <div class="row">
                <span class="key">Souris</span>
                <span class="action">Regarder</span>
            </div>
            <div class="row">
                <span class="key">Clic G</span>
                <span class="action">Attaquer</span>
            </div>
            <div class="row">
                <span class="key">Clic D</span>
                <span class="action">Bloquer</span>
            </div>
            <div class="row">
                <span class="key" data-control="crouch">Ctrl</span>
                <span class="action">S'accroupir</span>
            </div>
            <div class="row">
                <span class="key" data-control="interact">F</span>
                <span class="action">Interagir</span>
            </div>
            <div class="row">
                <span class="key">1-4</span>
                <span class="action">Potion</span>
            </div>
            <div class="row">
                <span class="key" data-control="pause">P</span>
                <span class="action">Pause</span>
            </div>
        </div>
        <div id="loading">
            <div class="loading-content">
                <h1 class="loading-title">DUNGEON</h1>
                <div class="loading-spinner"></div>
                <p class="loading-text">Chargement<span class="loading-dots"></span></p>
                <p class="loading-tip">Utilisez le bouclier pour bloquer les attaques ennemies</p>
            </div>
        </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
</body>
</html>
